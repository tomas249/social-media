function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"305l":function(e,t,n){"use strict";n.r(t),n.d(t,"AuthModule",(function(){return q}));var o,r=n("ofXK"),i=n("3Pt+"),s=n("tyNb"),a=n("fXoL"),c=n("vkgz"),u=n("H+bZ"),l=n("rj1t"),g=((o=function(){function e(t,n,o){_classCallCheck(this,e),this.api=t,this.token=n,this.router=o}return _createClass(e,[{key:"register",value:function(e){return this.api.post("/auth/register",e)}},{key:"login",value:function(e){var t=this;return this.api.post("/auth/login",e).pipe(Object(c.a)((function(e){t.token.setTokens(e.data.refreshToken,e.data.accessToken)})))}},{key:"logout",value:function(){var e=this,t=this.token.getRefreshToken();return this.api.post("/auth/logout",{refreshToken:t}).pipe(Object(c.a)((function(t){e.token.removeTokens(),e.router.navigate(["/explore"])})))}},{key:"getActiveAccounts",value:function(){return this.api.get("/tokens/associated")}},{key:"revokeToken",value:function(e){return this.api.post("/tokens/remove",{refreshToken:e})}}]),e}()).\u0275fac=function(e){return new(e||o)(a.Sb(u.a),a.Sb(l.a),a.Sb(s.d))},o.\u0275prov=a.Fb({token:o,factory:o.\u0275fac,providedIn:"root"}),o),f=n("N3Xk"),m=n("Kszi");function p(e,t){if(1&e&&(a.Ob(0,"p",9),a.uc(1),a.Nb()),2&e){var n=t.$implicit,o=a.ac(2);a.fc("ngClass",o.success?"success":"error"),a.zb(1),a.wc(" ",n," ")}}function h(e,t){if(1&e&&(a.Ob(0,"div",7),a.sc(1,p,2,2,"p",8),a.Nb()),2&e){var n=a.ac();a.zb(1),a.fc("ngForOf",n.messageList)}}var b,d=((b=function(){function e(t,n,o,r,s,c){_classCallCheck(this,e),this.fb=t,this.auth=n,this.token=o,this.router=r,this.navbarService=s,this.modalService=c,this.modalBox=!1,this.loginResponse=new a.n,this.messageList=[],this.success=!1,this.navigateEnd=!0,this.loginForm=this.fb.group({email:["",[i.i.required,i.i.maxLength(50),i.i.email]],password:["",[i.i.required,i.i.minLength(4),i.i.maxLength(40)]]})}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"errorMessages",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{required:(e=e.charAt(0).toUpperCase()+e.slice(1))+" field is required",maxlength:"".concat(e," field max length is ").concat(n," characters"),minlength:"".concat(e," field min length is ").concat(n," characters"),email:"Enter a valid email"}[t]}},{key:"getFormValidationErrors",value:function(){var e=this;this.messageList=[],Object.keys(this.loginForm.controls).forEach((function(t){var n=e.loginForm.get(t).errors;null!==n&&Object.keys(n).forEach((function(o){var r=n[o],i=e.errorMessages(t,o,"object"==typeof r?r.requiredLength:null);e.messageList.push(i)}))}))}},{key:"onLogin",value:function(){var e=this;if(this.getFormValidationErrors(),!this.loginForm.invalid){var t={email:this.loginForm.get("email").value.toLowerCase(),password:this.loginForm.get("password").value};this.auth.login(t).subscribe((function(t){e.modalService.emitResponse(!0,!0),e.navigateEnd&&e.navbarService.go("/explore")}),(function(t){var n=t.error;e.success=n.success,e.messageList.push(n.message)}))}}}]),e}()).\u0275fac=function(e){return new(e||b)(a.Jb(i.b),a.Jb(g),a.Jb(l.a),a.Jb(s.d),a.Jb(f.a),a.Jb(m.a))},b.\u0275cmp=a.Db({type:b,selectors:[["app-login"]],inputs:{modalBox:"modalBox"},outputs:{loginResponse:"loginResponse"},decls:9,vars:2,consts:[[1,"auth-container"],[1,"auth",3,"formGroup","ngSubmit"],[1,"title"],["formControlName","email","autocomplete","on","type","text","placeholder","Email (demo: tomas@gmail.com)",1,"input"],["formControlName","password","autocomplete","on","type","password","placeholder","Password (demo: 1234)",1,"input"],["type","submit",1,"input","button","btn"],["class","message",4,"ngIf"],[1,"message"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(e,t){1&e&&(a.Ob(0,"div",0),a.Ob(1,"form",1),a.Wb("ngSubmit",(function(){return t.onLogin()})),a.Ob(2,"span",2),a.uc(3,"Sign in"),a.Nb(),a.Kb(4,"input",3),a.Kb(5,"input",4),a.Ob(6,"button",5),a.uc(7,"Login"),a.Nb(),a.sc(8,h,2,1,"div",6),a.Nb(),a.Nb()),2&e&&(a.zb(1),a.fc("formGroup",t.loginForm),a.zb(7),a.fc("ngIf",0!==t.messageList.length))},directives:[i.j,i.g,i.d,i.a,i.f,i.c,r.k,r.j,r.i],styles:[".auth-container[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;justify-content:center}.auth[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:700%}.title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:400;text-align:center}.input[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;font-size:1rem;border-radius:16px;outline:0;border:0;color:#495057;letter-spacing:.2rem;font-weight:500}.btn[_ngcontent-%COMP%]{width:100%;cursor:pointer;color:var(--text-color);background-color:var(--primary-color);font-weight:700}.disabled[_ngcontent-%COMP%]{background-color:var(--hover-color);cursor:not-allowed}.btn[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#15ac59}.message[_ngcontent-%COMP%]{margin-top:2rem}.message[_ngcontent-%COMP%], .success[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem}.success[_ngcontent-%COMP%]{color:var(--primary-color)}.error[_ngcontent-%COMP%]{color:#ff4040;text-align:center;font-size:1.2rem}"]}),b);function v(e,t){if(1&e&&(a.Ob(0,"p",11),a.uc(1),a.Nb()),2&e){var n=t.$implicit,o=a.ac(2);a.fc("ngClass",o.success?"success":"error"),a.zb(1),a.wc(" ",n," ")}}function k(e,t){if(1&e&&(a.Ob(0,"div",9),a.sc(1,v,2,2,"p",10),a.Nb()),2&e){var n=a.ac();a.zb(1),a.fc("ngForOf",n.messageList)}}var C,y,O=((y=function(){function e(t,n){_classCallCheck(this,e),this.auth=t,this.fb=n,this.messageList=[],this.success=!1,this.registerForm=this.fb.group({name:["",[i.i.required,i.i.minLength(4),i.i.maxLength(30),this.noEmail.bind(this)]],email:["",[i.i.required,i.i.maxLength(50),i.i.email]],password:["",[i.i.required,i.i.minLength(4),i.i.maxLength(40)]],confirmPassword:["",[i.i.required,this.mustMatch.bind(this)]]})}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"noEmail",value:function(e){var t=e.value;if(t&&-1!==t.indexOf("@"))return{isEmail:"yes"}}},{key:"mustMatch",value:function(e){return this.registerForm?this.registerForm.value.password===e.value?null:{mustMatch:"true"}:null}},{key:"errorMessages",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return{required:(e=e.charAt(0).toUpperCase()+e.slice(1))+" field is required",maxlength:"".concat(e," field max length is ").concat(n," characters"),minlength:"".concat(e," field min length is ").concat(n," characters"),mustMatch:"Both passwords must match",isEmail:e+" can not contain @",email:"Enter a valid email"}[t]||"Unrecognized validator (Field: ".concat(e,", KeyError: ").concat(t,")")}},{key:"getFormValidationErrors",value:function(){var e=this;this.messageList=[],Object.keys(this.registerForm.controls).forEach((function(t){var n=e.registerForm.get(t).errors;null!==n&&Object.keys(n).forEach((function(o){var r=n[o],i=e.errorMessages(t,o,"object"==typeof r?r.requiredLength:null);e.messageList.push(i)}))}))}},{key:"onRegister",value:function(){var e=this;if(this.getFormValidationErrors(),!this.registerForm.invalid){var t={name:this.registerForm.get("name").value,email:this.registerForm.get("email").value.toLowerCase(),password:this.registerForm.get("password").value};this.auth.register(t).subscribe((function(t){console.warn(t),e.success=t.success,e.messageList.push(t.message),e.registerForm.reset()}),(function(t){var n=t.error;e.success=n.success,e.messageList.push(n.message)}))}}}]),e}()).\u0275fac=function(e){return new(e||y)(a.Jb(g),a.Jb(i.b))},y.\u0275cmp=a.Db({type:y,selectors:[["app-register"]],decls:11,vars:2,consts:[[1,"auth-container"],[1,"auth",3,"formGroup","ngSubmit"],[1,"title"],["formControlName","name","autocomplete","on","type","text","placeholder","Name (can be changed)",1,"input"],["formControlName","email","autocomplete","on","type","text","placeholder","Email",1,"input"],["formControlName","password","autocomplete","on","type","password","placeholder","Password",1,"input"],["formControlName","confirmPassword","type","password","placeholder","Confirm Password",1,"input"],["type","submit",1,"input","button","btn"],["class","message",4,"ngIf"],[1,"message"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(e,t){1&e&&(a.Ob(0,"div",0),a.Ob(1,"form",1),a.Wb("ngSubmit",(function(){return t.onRegister()})),a.Ob(2,"span",2),a.uc(3,"Sign up"),a.Nb(),a.Kb(4,"input",3),a.Kb(5,"input",4),a.Kb(6,"input",5),a.Kb(7,"input",6),a.Ob(8,"button",7),a.uc(9,"Create account"),a.Nb(),a.sc(10,k,2,1,"div",8),a.Nb(),a.Nb()),2&e&&(a.zb(1),a.fc("formGroup",t.registerForm),a.zb(9),a.fc("ngIf",0!==t.messageList.length))},directives:[i.j,i.g,i.d,i.a,i.f,i.c,r.k,r.j,r.i],styles:[".auth-container[_ngcontent-%COMP%]{height:auto;justify-content:center}.auth[_ngcontent-%COMP%], .auth-container[_ngcontent-%COMP%]{width:100%;display:flex}.auth[_ngcontent-%COMP%]{flex-direction:column}.title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:400;text-align:center}.input[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;font-size:1rem;border-radius:16px;outline:0;border:0;color:#495057;letter-spacing:.2rem;font-weight:500}.btn[_ngcontent-%COMP%]{width:100%;cursor:pointer;color:var(--text-color);background-color:var(--primary-color);font-weight:700}.disabled[_ngcontent-%COMP%]{background-color:var(--hover-color);cursor:not-allowed}.btn[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#15ac59}.message[_ngcontent-%COMP%]{margin-top:2rem}.message[_ngcontent-%COMP%], .success[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem}.success[_ngcontent-%COMP%]{color:var(--primary-color)}.error[_ngcontent-%COMP%]{color:#ff4040;text-align:center;font-size:1.2rem}"]}),y),w=((C=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||C)},C.\u0275cmp=a.Db({type:C,selectors:[["app-auth"]],decls:2,vars:0,consts:[[1,"container"]],template:function(e,t){1&e&&(a.Ob(0,"div",0),a.Kb(1,"router-outlet"),a.Nb())},directives:[s.f],styles:[".container[_ngcontent-%COMP%]{padding:2rem}"]}),C),_=n("yHma"),M=n("6Kw5");function P(e,t){if(1&e){var n=a.Pb();a.Ob(0,"button",10),a.Wb("click",(function(){a.nc(n);var e=a.ac().$implicit;return a.ac(2).onRevoke(e.token)})),a.uc(1," Revoke "),a.Nb()}}function x(e,t){1&e&&(a.Ob(0,"span"),a.uc(1,"Current"),a.Nb())}function L(e,t){if(1&e&&(a.Ob(0,"div",6),a.Ob(1,"div",7),a.Ob(2,"span"),a.uc(3),a.Nb(),a.Ob(4,"span"),a.uc(5),a.bc(6,"dateAgo"),a.Nb(),a.Nb(),a.sc(7,P,2,0,"button",8),a.sc(8,x,2,0,"ng-template",null,9,a.tc),a.Nb()),2&e){var n=t.$implicit,o=a.kc(9),r=a.ac(2);a.zb(3),a.vc(n.title),a.zb(2),a.wc("> ",a.cc(6,4,n.createdAt),""),a.zb(2),a.fc("ngIf",n.token!==r.refreshToken)("ngIfElse",o)}}function N(e,t){if(1&e&&(a.Mb(0),a.sc(1,L,10,6,"div",5),a.Lb()),2&e){var n=a.ac();a.zb(1),a.fc("ngForOf",n.tokens)}}var F,S,z,A,j=((F=function(){function e(t,n,o,r,i){_classCallCheck(this,e),this.authService=t,this.token=n,this.navbarService=o,this.locationService=r,this.modalService=i}return _createClass(e,[{key:"ngOnInit",value:function(){this.user=this.token.getUserData(),this.locationService.setStack(["Accounts"]),this.onGetAssociated()}},{key:"logout",value:function(){var e=this;this.modalService.open({type:"default",content:[{html:"Are you sure you want to close your account?"},{buttons:[{title:"Accept",close:!0,event:!0},{title:"Cancel",close:!0,event:!1}]}]},{action:"add",stack:["Logout confirm"]},(function(t){t&&e.authService.logout().subscribe((function(t){e.token.removeTokens(),e.navbarService.go("/explore")}),(function(t){e.token.removeTokens(),e.navbarService.go("/explore")}))}))}},{key:"onGetAssociated",value:function(){var e=this;this.refreshToken=this.token.getRefreshToken(),this.authService.getActiveAccounts().subscribe((function(t){e.tokens=t}))}},{key:"onRevoke",value:function(e){var t=this;this.authService.revokeToken(e).subscribe((function(n){t.tokens=t.tokens.filter((function(t){return t.token!==e}))}))}}]),e}()).\u0275fac=function(e){return new(e||F)(a.Jb(g),a.Jb(l.a),a.Jb(f.a),a.Jb(_.a),a.Jb(m.a))},F.\u0275cmp=a.Db({type:F,selectors:[["app-accounts"]],decls:20,vars:4,consts:[[1,"container"],[1,"acc-info"],[1,"primary"],[1,"empty-wrapper","logout-bttn",3,"click"],[4,"ngIf"],["class","token-item",4,"ngFor","ngForOf"],[1,"token-item"],[1,"token-data"],["class","empty-wrapper revoke-bttn",3,"click",4,"ngIf","ngIfElse"],["currentTkn",""],[1,"empty-wrapper","revoke-bttn",3,"click"]],template:function(e,t){1&e&&(a.Ob(0,"div",0),a.Ob(1,"div",1),a.Ob(2,"div"),a.uc(3,"Name: "),a.Ob(4,"span",2),a.uc(5),a.Nb(),a.Nb(),a.Ob(6,"div"),a.uc(7,"Username: "),a.Ob(8,"span",2),a.uc(9),a.Nb(),a.Nb(),a.Ob(10,"div"),a.uc(11,"Id: "),a.Ob(12,"span",2),a.uc(13),a.Nb(),a.Nb(),a.Nb(),a.Ob(14,"button",3),a.Wb("click",(function(){return t.logout()})),a.uc(15,"Logout"),a.Nb(),a.Nb(),a.Ob(16,"span"),a.uc(17,"Active sessions:"),a.Nb(),a.Kb(18,"hr"),a.sc(19,N,2,1,"ng-container",4)),2&e&&(a.zb(5),a.vc(t.user.name),a.zb(4),a.wc("@",t.user.username,""),a.zb(4),a.vc(t.user.id),a.zb(6),a.fc("ngIf",t.tokens))},directives:[r.k,r.j],pipes:[M.a],styles:[".container[_ngcontent-%COMP%]{flex-direction:row;justify-content:space-around;margin-bottom:2rem}.container[_ngcontent-%COMP%], .token-item[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.token-item[_ngcontent-%COMP%]{justify-content:space-between;align-items:center;padding:1rem}.token-item[_ngcontent-%COMP%]:hover{background-color:var(--hover-empty-color)}.token-data[_ngcontent-%COMP%]{display:flex;flex-direction:column}.empty-wrapper[_ngcontent-%COMP%]{background-color:transparent}.empty-wrapper[_ngcontent-%COMP%]:hover{background-color:var(--hover-solid-color)}.revoke-bttn[_ngcontent-%COMP%]{padding:.5rem 1rem}.logout-bttn[_ngcontent-%COMP%]{margin-top:1rem;padding:0 2rem;height:3rem}"]}),F),E=n("P6bf"),I=((S=function(){function e(t,n,o,r){_classCallCheck(this,e),this.token=t,this.location=n,this.router=o,this.activatedRoute=r}return _createClass(e,[{key:"canActivate",value:function(){return!this.token.isLogged()}}]),e}()).\u0275fac=function(e){return new(e||S)(a.Sb(l.a),a.Sb(r.g),a.Sb(s.d),a.Sb(s.a))},S.\u0275prov=a.Fb({token:S,factory:S.\u0275fac,providedIn:"root"}),S),T=[{path:"",component:w,children:[{path:"login",component:d,canActivate:[I]},{path:"register",component:O,canActivate:[I]},{path:"accounts",component:j,canActivate:[E.a]}]}],J=((z=function e(){_classCallCheck(this,e)}).\u0275mod=a.Hb({type:z}),z.\u0275inj=a.Gb({factory:function(e){return new(e||z)},imports:[[s.e.forChild(T)],s.e]}),z),R=n("ecLf"),K=n("iTUp"),q=((A=function e(){_classCallCheck(this,e)}).components={AuthComponent:w,LoginComponent:d,RegisterComponent:O,AccountsComponent:j},A.menu={root:"Auth",trigger:["Login","Register"],children:[{name:"Login",component:"Login"},{name:"Register",component:"Register"}]},A.\u0275mod=a.Hb({type:A}),A.\u0275inj=a.Gb({factory:function(e){return new(e||A)},imports:[[r.c,J,K.a,i.e,i.h,R.a]]}),A)},"6Kw5":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("fXoL"),r=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e,t){if(e){var n=Math.floor((+new Date-+new Date(e))/1e3);if(n<29)return"Just now";var o,r={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};for(var i in r)if((o=Math.floor(n/r[i]))>0)return 1===o?o+" "+i+" ago":o+" "+i+"s ago"}return e}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=o.Ib({name:"dateAgo",type:e,pure:!0}),e}()},iTUp:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("fXoL"),r=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=o.Hb({type:e}),e.\u0275inj=o.Gb({factory:function(t){return new(t||e)}}),e}()}}]);