(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"305l":function(e,t,n){"use strict";n.r(t),n.d(t,"AuthModule",(function(){return A}));var o=n("ofXK"),r=n("3Pt+"),s=n("tyNb"),i=n("fXoL"),c=n("vkgz"),a=n("H+bZ"),u=n("rj1t");let l=(()=>{class e{constructor(e,t,n){this.api=e,this.token=t,this.router=n}register(e){return this.api.post("/auth/register",e)}login(e){return this.api.post("/auth/login",e).pipe(Object(c.a)(e=>{this.token.setTokens(e.data.refreshToken,e.data.accessToken)}))}logout(){const e=this.token.getRefreshToken();return this.api.post("/auth/logout",{refreshToken:e}).pipe(Object(c.a)(e=>{this.token.removeTokens(),this.router.navigate(["/explore"])}))}getActiveAccounts(){return this.api.get("/tokens/associated")}revokeToken(e){return this.api.post("/tokens/remove",{refreshToken:e})}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(a.a),i.Sb(u.a),i.Sb(s.d))},e.\u0275prov=i.Fb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var g=n("N3Xk"),m=n("Kszi");function p(e,t){if(1&e&&(i.Ob(0,"p",9),i.uc(1),i.Nb()),2&e){const e=t.$implicit,n=i.ac(2);i.fc("ngClass",n.success?"success":"error"),i.zb(1),i.wc(" ",e," ")}}function h(e,t){if(1&e&&(i.Ob(0,"div",7),i.sc(1,p,2,2,"p",8),i.Nb()),2&e){const e=i.ac();i.zb(1),i.fc("ngForOf",e.messageList)}}let b=(()=>{class e{constructor(e,t,n,o,s,c){this.fb=e,this.auth=t,this.token=n,this.router=o,this.navbarService=s,this.modalService=c,this.modalBox=!1,this.loginResponse=new i.n,this.messageList=[],this.success=!1,this.navigateEnd=!0,this.loginForm=this.fb.group({email:["",[r.i.required,r.i.maxLength(50),r.i.email]],password:["",[r.i.required,r.i.minLength(4),r.i.maxLength(40)]]})}ngOnInit(){}errorMessages(e,t,n=null){return{required:(e=e.charAt(0).toUpperCase()+e.slice(1))+" field is required",maxlength:`${e} field max length is ${n} characters`,minlength:`${e} field min length is ${n} characters`,email:"Enter a valid email"}[t]}getFormValidationErrors(){this.messageList=[],Object.keys(this.loginForm.controls).forEach(e=>{const t=this.loginForm.get(e).errors;null!==t&&Object.keys(t).forEach(n=>{const o=t[n],r=this.errorMessages(e,n,"object"==typeof o?o.requiredLength:null);this.messageList.push(r)})})}onLogin(){if(this.getFormValidationErrors(),this.loginForm.invalid)return;let e={email:this.loginForm.get("email").value.toLowerCase(),password:this.loginForm.get("password").value};this.auth.login(e).subscribe(e=>{this.modalService.emitResponse(!0,!0),this.navigateEnd&&this.navbarService.go("/explore")},e=>{const t=e.error;this.success=t.success,this.messageList.push(t.message)})}}return e.\u0275fac=function(t){return new(t||e)(i.Jb(r.b),i.Jb(l),i.Jb(u.a),i.Jb(s.d),i.Jb(g.a),i.Jb(m.a))},e.\u0275cmp=i.Db({type:e,selectors:[["app-login"]],inputs:{modalBox:"modalBox"},outputs:{loginResponse:"loginResponse"},decls:9,vars:2,consts:[[1,"auth-container"],[1,"auth",3,"formGroup","ngSubmit"],[1,"title"],["formControlName","email","autocomplete","on","type","text","placeholder","Email (demo: tomas@gmail.com)",1,"input"],["formControlName","password","autocomplete","on","type","password","placeholder","Password (demo: 1234)",1,"input"],["type","submit",1,"input","button","btn"],["class","message",4,"ngIf"],[1,"message"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(e,t){1&e&&(i.Ob(0,"div",0),i.Ob(1,"form",1),i.Wb("ngSubmit",(function(){return t.onLogin()})),i.Ob(2,"span",2),i.uc(3,"Sign in"),i.Nb(),i.Kb(4,"input",3),i.Kb(5,"input",4),i.Ob(6,"button",5),i.uc(7,"Login"),i.Nb(),i.sc(8,h,2,1,"div",6),i.Nb(),i.Nb()),2&e&&(i.zb(1),i.fc("formGroup",t.loginForm),i.zb(7),i.fc("ngIf",0!==t.messageList.length))},directives:[r.j,r.g,r.d,r.a,r.f,r.c,o.k,o.j,o.i],styles:[".auth-container[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;justify-content:center}.auth[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:700%}.title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:400;text-align:center}.input[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;font-size:1rem;border-radius:16px;outline:0;border:0;color:#495057;letter-spacing:.2rem;font-weight:500}.btn[_ngcontent-%COMP%]{width:100%;cursor:pointer;color:var(--text-color);background-color:var(--primary-color);font-weight:700}.disabled[_ngcontent-%COMP%]{background-color:var(--hover-color);cursor:not-allowed}.btn[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#15ac59}.message[_ngcontent-%COMP%]{margin-top:2rem}.message[_ngcontent-%COMP%], .success[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem}.success[_ngcontent-%COMP%]{color:var(--primary-color)}.error[_ngcontent-%COMP%]{color:#ff4040;text-align:center;font-size:1.2rem}"]}),e})();function d(e,t){if(1&e&&(i.Ob(0,"p",11),i.uc(1),i.Nb()),2&e){const e=t.$implicit,n=i.ac(2);i.fc("ngClass",n.success?"success":"error"),i.zb(1),i.wc(" ",e," ")}}function f(e,t){if(1&e&&(i.Ob(0,"div",9),i.sc(1,d,2,2,"p",10),i.Nb()),2&e){const e=i.ac();i.zb(1),i.fc("ngForOf",e.messageList)}}let v=(()=>{class e{constructor(e,t){this.auth=e,this.fb=t,this.messageList=[],this.success=!1,this.registerForm=this.fb.group({name:["",[r.i.required,r.i.minLength(4),r.i.maxLength(30),this.noEmail.bind(this)]],email:["",[r.i.required,r.i.maxLength(50),r.i.email]],password:["",[r.i.required,r.i.minLength(4),r.i.maxLength(40)]],confirmPassword:["",[r.i.required,this.mustMatch.bind(this)]]})}ngOnInit(){}noEmail(e){const t=e.value;if(t&&-1!==t.indexOf("@"))return{isEmail:"yes"}}mustMatch(e){return this.registerForm?this.registerForm.value.password===e.value?null:{mustMatch:"true"}:null}errorMessages(e,t,n=null){return{required:(e=e.charAt(0).toUpperCase()+e.slice(1))+" field is required",maxlength:`${e} field max length is ${n} characters`,minlength:`${e} field min length is ${n} characters`,mustMatch:"Both passwords must match",isEmail:e+" can not contain @",email:"Enter a valid email"}[t]||`Unrecognized validator (Field: ${e}, KeyError: ${t})`}getFormValidationErrors(){this.messageList=[],Object.keys(this.registerForm.controls).forEach(e=>{const t=this.registerForm.get(e).errors;null!==t&&Object.keys(t).forEach(n=>{const o=t[n],r=this.errorMessages(e,n,"object"==typeof o?o.requiredLength:null);this.messageList.push(r)})})}onRegister(){if(this.getFormValidationErrors(),this.registerForm.invalid)return;const e={name:this.registerForm.get("name").value,email:this.registerForm.get("email").value.toLowerCase(),password:this.registerForm.get("password").value};this.auth.register(e).subscribe(e=>{console.warn(e),this.success=e.success,this.messageList.push(e.message),this.registerForm.reset()},e=>{const t=e.error;this.success=t.success,this.messageList.push(t.message)})}}return e.\u0275fac=function(t){return new(t||e)(i.Jb(l),i.Jb(r.b))},e.\u0275cmp=i.Db({type:e,selectors:[["app-register"]],decls:11,vars:2,consts:[[1,"auth-container"],[1,"auth",3,"formGroup","ngSubmit"],[1,"title"],["formControlName","name","autocomplete","on","type","text","placeholder","Name (can be changed)",1,"input"],["formControlName","email","autocomplete","on","type","text","placeholder","Email",1,"input"],["formControlName","password","autocomplete","on","type","password","placeholder","Password",1,"input"],["formControlName","confirmPassword","type","password","placeholder","Confirm Password",1,"input"],["type","submit",1,"input","button","btn"],["class","message",4,"ngIf"],[1,"message"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(e,t){1&e&&(i.Ob(0,"div",0),i.Ob(1,"form",1),i.Wb("ngSubmit",(function(){return t.onRegister()})),i.Ob(2,"span",2),i.uc(3,"Sign up"),i.Nb(),i.Kb(4,"input",3),i.Kb(5,"input",4),i.Kb(6,"input",5),i.Kb(7,"input",6),i.Ob(8,"button",7),i.uc(9,"Create account"),i.Nb(),i.sc(10,f,2,1,"div",8),i.Nb(),i.Nb()),2&e&&(i.zb(1),i.fc("formGroup",t.registerForm),i.zb(9),i.fc("ngIf",0!==t.messageList.length))},directives:[r.j,r.g,r.d,r.a,r.f,r.c,o.k,o.j,o.i],styles:[".auth-container[_ngcontent-%COMP%]{height:auto;justify-content:center}.auth[_ngcontent-%COMP%], .auth-container[_ngcontent-%COMP%]{width:100%;display:flex}.auth[_ngcontent-%COMP%]{flex-direction:column}.title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:400;text-align:center}.input[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;font-size:1rem;border-radius:16px;outline:0;border:0;color:#495057;letter-spacing:.2rem;font-weight:500}.btn[_ngcontent-%COMP%]{width:100%;cursor:pointer;color:var(--text-color);background-color:var(--primary-color);font-weight:700}.disabled[_ngcontent-%COMP%]{background-color:var(--hover-color);cursor:not-allowed}.btn[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#15ac59}.message[_ngcontent-%COMP%]{margin-top:2rem}.message[_ngcontent-%COMP%], .success[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem}.success[_ngcontent-%COMP%]{color:var(--primary-color)}.error[_ngcontent-%COMP%]{color:#ff4040;text-align:center;font-size:1.2rem}"]}),e})(),k=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Db({type:e,selectors:[["app-auth"]],decls:2,vars:0,consts:[[1,"container"]],template:function(e,t){1&e&&(i.Ob(0,"div",0),i.Kb(1,"router-outlet"),i.Nb())},directives:[s.f],styles:[".container[_ngcontent-%COMP%]{padding:2rem}"]}),e})();var O=n("yHma"),w=n("6Kw5");function C(e,t){if(1&e){const e=i.Pb();i.Ob(0,"button",10),i.Wb("click",(function(){i.nc(e);const t=i.ac().$implicit;return i.ac(2).onRevoke(t.token)})),i.uc(1," Revoke "),i.Nb()}}function y(e,t){1&e&&(i.Ob(0,"span"),i.uc(1,"Current"),i.Nb())}function M(e,t){if(1&e&&(i.Ob(0,"div",6),i.Ob(1,"div",7),i.Ob(2,"span"),i.uc(3),i.Nb(),i.Ob(4,"span"),i.uc(5),i.bc(6,"dateAgo"),i.Nb(),i.Nb(),i.sc(7,C,2,0,"button",8),i.sc(8,y,2,0,"ng-template",null,9,i.tc),i.Nb()),2&e){const e=t.$implicit,n=i.kc(9),o=i.ac(2);i.zb(3),i.vc(e.title),i.zb(2),i.wc("> ",i.cc(6,4,e.createdAt),""),i.zb(2),i.fc("ngIf",e.token!==o.refreshToken)("ngIfElse",n)}}function P(e,t){if(1&e&&(i.Mb(0),i.sc(1,M,10,6,"div",5),i.Lb()),2&e){const e=i.ac();i.zb(1),i.fc("ngForOf",e.tokens)}}let x=(()=>{class e{constructor(e,t,n,o,r){this.authService=e,this.token=t,this.navbarService=n,this.locationService=o,this.modalService=r}ngOnInit(){this.user=this.token.getUserData(),this.locationService.setStack(["Accounts"]),this.onGetAssociated()}logout(){this.modalService.open({type:"default",content:[{html:"Are you sure you want to close your account?"},{buttons:[{title:"Accept",close:!0,event:!0},{title:"Cancel",close:!0,event:!1}]}]},{action:"add",stack:["Logout confirm"]},e=>{e&&this.authService.logout().subscribe(e=>{this.token.removeTokens(),this.navbarService.go("/explore")},e=>{this.token.removeTokens(),this.navbarService.go("/explore")})})}onGetAssociated(){this.refreshToken=this.token.getRefreshToken(),this.authService.getActiveAccounts().subscribe(e=>{this.tokens=e})}onRevoke(e){this.authService.revokeToken(e).subscribe(t=>{this.tokens=this.tokens.filter(t=>t.token!==e)})}}return e.\u0275fac=function(t){return new(t||e)(i.Jb(l),i.Jb(u.a),i.Jb(g.a),i.Jb(O.a),i.Jb(m.a))},e.\u0275cmp=i.Db({type:e,selectors:[["app-accounts"]],decls:20,vars:4,consts:[[1,"container"],[1,"acc-info"],[1,"primary"],[1,"empty-wrapper","logout-bttn",3,"click"],[4,"ngIf"],["class","token-item",4,"ngFor","ngForOf"],[1,"token-item"],[1,"token-data"],["class","empty-wrapper revoke-bttn",3,"click",4,"ngIf","ngIfElse"],["currentTkn",""],[1,"empty-wrapper","revoke-bttn",3,"click"]],template:function(e,t){1&e&&(i.Ob(0,"div",0),i.Ob(1,"div",1),i.Ob(2,"div"),i.uc(3,"Name: "),i.Ob(4,"span",2),i.uc(5),i.Nb(),i.Nb(),i.Ob(6,"div"),i.uc(7,"Username: "),i.Ob(8,"span",2),i.uc(9),i.Nb(),i.Nb(),i.Ob(10,"div"),i.uc(11,"Id: "),i.Ob(12,"span",2),i.uc(13),i.Nb(),i.Nb(),i.Nb(),i.Ob(14,"button",3),i.Wb("click",(function(){return t.logout()})),i.uc(15,"Logout"),i.Nb(),i.Nb(),i.Ob(16,"span"),i.uc(17,"Active sessions:"),i.Nb(),i.Kb(18,"hr"),i.sc(19,P,2,1,"ng-container",4)),2&e&&(i.zb(5),i.vc(t.user.name),i.zb(4),i.wc("@",t.user.username,""),i.zb(4),i.vc(t.user.id),i.zb(6),i.fc("ngIf",t.tokens))},directives:[o.k,o.j],pipes:[w.a],styles:[".container[_ngcontent-%COMP%]{flex-direction:row;justify-content:space-around;margin-bottom:2rem}.container[_ngcontent-%COMP%], .token-item[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.token-item[_ngcontent-%COMP%]{justify-content:space-between;align-items:center;padding:1rem}.token-item[_ngcontent-%COMP%]:hover{background-color:var(--hover-empty-color)}.token-data[_ngcontent-%COMP%]{display:flex;flex-direction:column}.empty-wrapper[_ngcontent-%COMP%]{background-color:transparent}.empty-wrapper[_ngcontent-%COMP%]:hover{background-color:var(--hover-solid-color)}.revoke-bttn[_ngcontent-%COMP%]{padding:.5rem 1rem}.logout-bttn[_ngcontent-%COMP%]{margin-top:1rem;padding:0 2rem;height:3rem}"]}),e})();var L=n("P6bf");let N=(()=>{class e{constructor(e,t,n,o){this.token=e,this.location=t,this.router=n,this.activatedRoute=o}canActivate(){return!this.token.isLogged()}}return e.\u0275fac=function(t){return new(t||e)(i.Sb(u.a),i.Sb(o.g),i.Sb(s.d),i.Sb(s.a))},e.\u0275prov=i.Fb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const _=[{path:"",component:k,children:[{path:"login",component:b,canActivate:[N]},{path:"register",component:v,canActivate:[N]},{path:"accounts",component:x,canActivate:[L.a]}]}];let F=(()=>{class e{}return e.\u0275mod=i.Hb({type:e}),e.\u0275inj=i.Gb({factory:function(t){return new(t||e)},imports:[[s.e.forChild(_)],s.e]}),e})();var S=n("ecLf"),z=n("iTUp");let A=(()=>{class e{}return e.components={AuthComponent:k,LoginComponent:b,RegisterComponent:v,AccountsComponent:x},e.menu={root:"Auth",trigger:["Login","Register"],children:[{name:"Login",component:"Login"},{name:"Register",component:"Register"}]},e.\u0275mod=i.Hb({type:e}),e.\u0275inj=i.Gb({factory:function(t){return new(t||e)},imports:[[o.c,F,z.a,r.e,r.h,S.a]]}),e})()},"6Kw5":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("fXoL");let r=(()=>{class e{transform(e,t){if(e){const t=Math.floor((+new Date-+new Date(e))/1e3);if(t<29)return"Just now";const n={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};let o;for(const e in n)if(o=Math.floor(t/n[e]),o>0)return 1===o?o+" "+e+" ago":o+" "+e+"s ago"}return e}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=o.Ib({name:"dateAgo",type:e,pure:!0}),e})()},iTUp:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("fXoL");let r=(()=>{class e{}return e.\u0275mod=o.Hb({type:e}),e.\u0275inj=o.Gb({factory:function(t){return new(t||e)}}),e})()}}]);